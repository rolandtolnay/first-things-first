---
phase: 05.1-cross-section-drag-drop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/dnd.ts
  - src/components/calendar/PriorityItem.tsx
  - src/components/calendar/EveningSlot.tsx
  - src/components/dnd/DragOverlayContent.tsx
autonomous: true

must_haves:
  truths:
    - "Priority items show grab cursor on hover"
    - "Evening block shows grab cursor on hover"
    - "Dragging priority item shows visual preview"
    - "Dragging evening block shows visual preview"
  artifacts:
    - path: "src/types/dnd.ts"
      provides: "PriorityDragData and EveningDragData types"
      contains: "PriorityDragData"
    - path: "src/components/calendar/PriorityItem.tsx"
      provides: "Draggable priority item"
      contains: "useDraggable"
    - path: "src/components/calendar/EveningSlot.tsx"
      provides: "Draggable evening block"
      contains: "useDraggable"
  key_links:
    - from: "PriorityItem.tsx"
      to: "dnd.ts"
      via: "PriorityDragData import"
      pattern: "PriorityDragData"
    - from: "EveningSlot.tsx"
      to: "dnd.ts"
      via: "EveningDragData import"
      pattern: "EveningDragData"
---

<objective>
Make PriorityItem and EveningSlot blocks draggable with proper type definitions and visual previews.

Purpose: Enable dragging FROM the priorities and evening sections, not just TO them.
Output: Extended dnd types, draggable components, and DragOverlay support for all item types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-drag-drop-integration/05-01-SUMMARY.md

@src/types/dnd.ts
@src/components/calendar/PriorityItem.tsx
@src/components/calendar/EveningSlot.tsx
@src/components/dnd/DragOverlayContent.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend drag data types</name>
  <files>src/types/dnd.ts</files>
  <action>
Add two new drag data types to support dragging from priorities and evening sections:

1. **PriorityDragData** - For dragging priority items:
   - type: "priority"
   - priorityId: string (the DayPriority id)
   - goalId: string (the associated goal)
   - roleId: string (for color)
   - text: string (goal text for preview)
   - sourceDayIndex: DayOfWeek (where it came from)

2. **EveningDragData** - For dragging evening blocks:
   - type: "evening"
   - eveningBlockId: string (the EveningBlock id)
   - goalId?: string (if goal-based)
   - roleId?: string (for color)
   - title: string (block title for preview)
   - sourceDayIndex: DayOfWeek (where it came from)

Update DragData union to include all four types: GoalDragData | BlockDragData | PriorityDragData | EveningDragData.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>New drag data types exported and DragData union updated</done>
</task>

<task type="auto">
  <name>Task 2: Make PriorityItem draggable</name>
  <files>src/components/calendar/PriorityItem.tsx</files>
  <action>
Add useDraggable hook to PriorityItem component:

1. Import useDraggable from @dnd-kit/core and PriorityDragData from types
2. Props already has: priority, goal, roleColor - need to add dayIndex prop
3. Set up useDraggable with:
   - id: `priority-${priority.id}`
   - data: PriorityDragData with all fields (use satisfies for type safety)
4. Apply ref={setNodeRef}, {...listeners}, {...attributes} to the main div
5. Add cursor-grab and active:cursor-grabbing classes
6. Add isDragging && "opacity-50" for visual feedback during drag
7. Keep delete button functional - it should still work (child click events propagate)

Update DayPriorities.tsx to pass dayIndex to PriorityItem.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. App loads without errors
  </verify>
  <done>PriorityItem is draggable with visual feedback</done>
</task>

<task type="auto">
  <name>Task 3: Make evening block draggable</name>
  <files>src/components/calendar/EveningSlot.tsx</files>
  <action>
Add useDraggable hook to the evening block (NOT the empty slot container):

1. Import useDraggable from @dnd-kit/core and EveningDragData from types
2. Create a separate inner component or move the block rendering to use useDraggable
3. Set up useDraggable with:
   - id: `evening-block-${eveningBlock.id}`
   - data: EveningDragData with all fields (use satisfies for type safety)
4. Apply ref={setNodeRef}, {...listeners}, {...attributes} to the block div (not the container)
5. Add cursor-grab and active:cursor-grabbing classes to the block
6. Add isDragging && "opacity-50" for visual feedback
7. Keep the droppable on the outer container and the draggable on the inner block

IMPORTANT: The outer EveningSlot container must remain droppable (useDroppable), only the inner block content should be draggable (useDraggable). This allows dropping onto empty evening slots while making filled blocks draggable.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. App loads without errors
  </verify>
  <done>Evening blocks are draggable with visual feedback</done>
</task>

<task type="auto">
  <name>Task 4: Add DragOverlay support for new item types</name>
  <files>src/components/dnd/DragOverlayContent.tsx</files>
  <action>
Extend DragOverlayContent to handle priority and evening drag data:

1. Add handling for type === "priority":
   - Show compact preview similar to PriorityItem
   - Use role color from drag data (roleId → lookup color → getRoleColorStyle)
   - Display text from drag data
   - Style: left border color, compact text

2. Add handling for type === "evening":
   - Show preview similar to evening block
   - Use role color if present (roleId → lookup), else neutral background
   - Display title from drag data
   - Style: role color background with opacity + left border, or muted for freestyle

Both should match the visual style of their source components but as floating previews (fixed size, not absolutely positioned).
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `npm run build` succeeds
  </verify>
  <done>DragOverlay shows appropriate previews for all draggable item types</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npx tsc --noEmit` passes
- [ ] `npm run build` succeeds
- [ ] App loads without console errors
- [ ] Can drag a priority item (shows grab cursor, preview appears)
- [ ] Can drag an evening block (shows grab cursor, preview appears)
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- PriorityItem and EveningSlot blocks are draggable
- DragOverlay shows correct previews for all item types
- Existing functionality (delete buttons, drop zones) still works
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-cross-section-drag-drop/05.1-01-SUMMARY.md`
</output>
