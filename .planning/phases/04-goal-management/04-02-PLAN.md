---
phase: 04-goal-management
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - src/components/sidebar/GoalList.tsx
  - src/components/sidebar/RoleSection.tsx
  - src/components/sidebar/RoleList.tsx
autonomous: false

must_haves:
  truths:
    - "User can see goals listed under each role"
    - "User can add multiple goals to any role"
    - "User can delete a goal from the sidebar"
    - "Goals display with their role's color"
  artifacts:
    - path: "src/components/sidebar/GoalList.tsx"
      provides: "Goal list container for a role"
      min_lines: 30
    - path: "src/components/sidebar/RoleSection.tsx"
      provides: "Role with expandable goals section"
      min_lines: 60
  key_links:
    - from: "RoleSection.tsx"
      to: "GoalList.tsx"
      via: "component composition"
      pattern: "<GoalList"
    - from: "GoalList.tsx"
      to: "GoalItem.tsx"
      via: "map iteration"
      pattern: "GoalItem"
    - from: "RoleList.tsx"
      to: "RoleSection.tsx"
      via: "replacement of RoleItem"
      pattern: "<RoleSection"
---

<objective>
Integrate goal components into the sidebar UI with role sections.

Purpose: Display goals under each role, enabling full goal management in the sidebar.
Output: Working goal list UI visible under each role with add/delete functionality.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-goal-management/04-01-SUMMARY.md

# Components to modify/create:
@src/components/sidebar/RoleList.tsx
@src/components/sidebar/RoleItem.tsx

# Store selector for goals by role:
@src/stores/weekStore.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GoalList component</name>
  <files>src/components/sidebar/GoalList.tsx</files>
  <action>
Create GoalList component:

1. Props: `roleId: string`, `roleColor: RoleColor`
2. Get goals from store using selectGoalsByRole pattern or filter in useMemo
3. Render GoalItem for each goal, passing roleColor
4. Render AddGoalButton at the end with roleId
5. Handle empty state (just show AddGoalButton)

Use useMemo for goal filtering to avoid hydration issues (same pattern as RoleList).
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>GoalList renders goals for a role with add button</done>
</task>

<task type="auto">
  <name>Task 2: Create RoleSection component</name>
  <files>src/components/sidebar/RoleSection.tsx</files>
  <action>
Create RoleSection component that combines RoleItem header with GoalList:

1. Props: `role: Role`
2. Structure:
   - Role header (color dot, name, edit/delete) - reuse RoleItem logic or compose
   - GoalList underneath (slightly indented)
3. Option: Make goals collapsible (click role toggles visibility) - nice to have, not required
4. Pass role.id and role.color to GoalList

Simplest approach: Render RoleItem-like header inline, then GoalList below.
Alternative: Keep RoleItem as-is, add onClick to expand/collapse GoalList.

Choose the simpler approach - inline the header to avoid prop drilling complexity.
  </action>
  <verify>npx tsc --noEmit passes</verify>
  <done>RoleSection shows role header with goals underneath</done>
</task>

<task type="auto">
  <name>Task 3: Update RoleList to use RoleSection</name>
  <files>src/components/sidebar/RoleList.tsx</files>
  <action>
Modify RoleList to render RoleSection instead of RoleItem:

1. Import RoleSection instead of (or in addition to) RoleItem
2. Replace `<RoleItem key={role.id} role={role} />` with `<RoleSection key={role.id} role={role} />`
3. Keep AddRoleButton at the end
4. Keep loading and empty states

This integrates goals into the existing role list structure.
  </action>
  <verify>npm run build succeeds</verify>
  <done>RoleList displays roles with their goals via RoleSection</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Goal management UI in sidebar - goals display under roles, add/delete works</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:3000
    3. Create a role if none exist
    4. Click "+ Add Goal" under a role
    5. Type goal text and press Enter - goal should appear
    6. Add another goal to same role - both should display
    7. Hover over a goal - delete button (X) should appear
    8. Delete a goal - confirm dialog, goal removed
    9. Double-click a goal text - should enter edit mode
    10. Edit and press Enter - text should update
    11. Goals should persist after page refresh
    12. Test in both light and dark mode
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Goals display under each role
- [ ] Add goal creates new goal for that role
- [ ] Delete goal removes goal with confirmation
- [ ] Edit goal updates text
- [ ] Goals persist across refresh
- [ ] Works in light and dark mode
</verification>

<success_criteria>

- All tasks completed
- User approved visual/functional verification
- Goals are fully manageable in sidebar (add, edit, delete)
- Goals display with role color coding
</success_criteria>

<output>
After completion, create `.planning/phases/04-goal-management/04-02-SUMMARY.md`
</output>
