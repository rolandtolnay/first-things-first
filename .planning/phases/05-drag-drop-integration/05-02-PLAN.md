---
phase: 05-drag-drop-integration
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/components/sidebar/GoalItem.tsx
  - src/components/calendar/DayPriorities.tsx
  - src/components/calendar/PriorityItem.tsx
  - src/components/dnd/DndProvider.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag a goal from sidebar"
    - "Dragging goal over Day Priorities shows visual highlight"
    - "Dropping goal on Day Priorities creates a DayPriority entry"
    - "Priority item displays in Day Priorities section"
  artifacts:
    - path: "src/components/sidebar/GoalItem.tsx"
      provides: "Draggable goal item"
      contains: "useDraggable"
    - path: "src/components/calendar/DayPriorities.tsx"
      provides: "Drop zone for priorities"
      contains: "useDroppable"
    - path: "src/components/calendar/PriorityItem.tsx"
      provides: "Visual display of dropped priority"
      min_lines: 30
  key_links:
    - from: "GoalItem"
      to: "DndContext"
      via: "useDraggable hook"
      pattern: "useDraggable"
    - from: "DayPriorities"
      to: "DndContext"
      via: "useDroppable hook"
      pattern: "useDroppable"
    - from: "DndProvider onDragEnd"
      to: "weekStore.addDayPriority"
      via: "drop handler for priorities zone"
      pattern: "addDayPriority"
---

<objective>
Enable dragging goals from sidebar and dropping onto Day Priorities sections.

Purpose: First drag-drop interaction - goals to Day Priorities.
Output: Goals can be dragged from sidebar and dropped onto any day's priorities section.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-drag-drop-integration/05-RESEARCH.md
@.planning/phases/05-drag-drop-integration/05-01-SUMMARY.md

@src/components/sidebar/GoalItem.tsx
@src/components/calendar/DayPriorities.tsx
@src/components/dnd/DndProvider.tsx
@src/stores/weekStore.ts
@src/types/dnd.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Make GoalItem draggable</name>
  <files>src/components/sidebar/GoalItem.tsx</files>
  <action>
    Add drag capability to GoalItem:

    1. Import useDraggable from @dnd-kit/core
    2. Import GoalDragData from @/types/dnd
    3. Call useDraggable with:
       - id: `goal-${goal.id}` (unique across all draggables)
       - data: { type: 'goal', goalId: goal.id, roleId: goal.roleId, text: goal.text } satisfies GoalDragData
       - disabled: isEditing (disable drag when editing text)
    4. Destructure: { attributes, listeners, setNodeRef, isDragging }
    5. Apply to the outer div:
       - ref={setNodeRef}
       - {...listeners}
       - {...attributes}
    6. Add isDragging styling: opacity-50 when dragging

    **CRITICAL:** Only spread listeners on the element that should initiate drag. Since the whole item should be draggable, spread on the outer div.

    **Important:** The delete button and notes icon should still work - listeners don't prevent child clicks.
  </action>
  <verify>npm run build passes; app loads; hovering over goal shows grab cursor</verify>
  <done>GoalItem is draggable, shows reduced opacity while dragging</done>
</task>

<task type="auto">
  <name>Task 2: Create PriorityItem component</name>
  <files>src/components/calendar/PriorityItem.tsx</files>
  <action>
    Create component to display a priority item in Day Priorities:

    1. "use client" component
    2. Props: priority: DayPriority, goal: Goal, roleColor: RoleColor
    3. Display:
       - Role color left border (3px, same as GoalItem)
       - Goal text (truncated with title tooltip)
       - Delete button (X) on hover to remove priority
    4. Use getRoleColorStyle for color
    5. Call removeDayPriority from weekStore on delete

    Styling: Similar to GoalItem but slightly more compact (text-xs, py-0.5)
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>PriorityItem component renders priority with goal text and delete capability</done>
</task>

<task type="auto">
  <name>Task 3: Make DayPriorities a drop zone</name>
  <files>src/components/calendar/DayPriorities.tsx</files>
  <action>
    Convert DayPriorities to a droppable zone that displays priorities:

    1. Import useDroppable from @dnd-kit/core
    2. Import DropZoneData from @/types/dnd
    3. Import useWeekStore, selectDayPriorities from stores
    4. Import PriorityItem component
    5. Call useDroppable with:
       - id: `priorities-${dayIndex}` (unique per day)
       - data: { zone: 'priorities', dayIndex } satisfies DropZoneData
    6. Destructure: { setNodeRef, isOver }
    7. Apply ref={setNodeRef} to the container div
    8. Add isOver styling: bg-primary/10 ring-1 ring-primary/50 when isOver is true
    9. Get priorities from store: const priorities = useWeekStore(state => selectDayPriorities(state, dayIndex))
    10. Get goals map for lookups: const goals = useWeekStore(state => state.currentWeek?.goals ?? [])
    11. For each priority, find the goal and role, render PriorityItem

    Use useMemo for goal lookups to prevent hydration issues (pattern from RoleList/GoalList).
  </action>
  <verify>npm run build passes; app loads; DayPriorities shows highlight on drag over</verify>
  <done>DayPriorities is a drop zone with visual feedback and renders priority items</done>
</task>

<task type="auto">
  <name>Task 4: Handle priorities drop in DndProvider</name>
  <files>src/components/dnd/DndProvider.tsx</files>
  <action>
    Implement the onDragEnd handler for priorities zone:

    1. Import useWeekStore from @/stores/weekStore
    2. Import DayOfWeek from @/types
    3. Import GoalDragData, DropZoneData from @/types/dnd
    4. In handleDragEnd:
       - Get active and over from event
       - If !over, return (dropped outside valid zone)
       - Cast active.data.current as DragData
       - Cast over.data.current as DropZoneData
       - If dragData.type === 'goal' && dropData.zone === 'priorities':
         - Call addDayPriority({ goalId: dragData.goalId, dayIndex: dropData.dayIndex as DayOfWeek, completed: false })

    Get addDayPriority from store: const addDayPriority = useWeekStore(state => state.addDayPriority)
  </action>
  <verify>npm run build passes; drag goal to Day Priorities creates entry</verify>
  <done>Dropping goal on Day Priorities creates DayPriority in store</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm run build succeeds
- [ ] Can drag goal from sidebar (shows grab cursor, reduced opacity)
- [ ] Dragging over Day Priorities shows visual highlight
- [ ] Dropping creates priority item in the section
- [ ] Priority item shows goal text with role color
- [ ] Can delete priority item
- [ ] Same goal can be dropped multiple times (creates multiple priority instances)
</verification>

<success_criteria>

- GoalItem has drag capability via useDraggable
- DayPriorities is a drop zone with visual feedback
- Dropping goal creates DayPriority entry
- Priority items display with role color and delete capability
- Drag-drop from sidebar to Day Priorities works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/05-drag-drop-integration/05-02-SUMMARY.md`
</output>
