---
phase: 05-drag-drop-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/types/dnd.ts
  - src/components/dnd/DndProvider.tsx
  - src/components/dnd/DragOverlayContent.tsx
  - src/components/dnd/index.ts
  - src/app/layout.tsx
autonomous: true

must_haves:
  truths:
    - "DndContext wraps the application"
    - "Pointer sensor activates after 8px movement"
    - "DragOverlay renders during drag operations"
  artifacts:
    - path: "src/components/dnd/DndProvider.tsx"
      provides: "DndContext wrapper with sensors and collision detection"
      min_lines: 50
    - path: "src/components/dnd/DragOverlayContent.tsx"
      provides: "Visual preview during drag"
      min_lines: 20
    - path: "src/types/dnd.ts"
      provides: "TypeScript types for drag/drop data"
      exports: ["GoalDragData", "BlockDragData", "DropZoneData"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "DndProvider"
      via: "wraps children"
      pattern: "<DndProvider>"
---

<objective>
Set up dnd-kit infrastructure for drag-drop functionality across the application.

Purpose: Establish the foundational drag-drop context that all subsequent plans will build upon.
Output: DndProvider component wrapping the app with sensors, collision detection, and drag overlay.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-drag-drop-integration/05-RESEARCH.md

@src/app/layout.tsx
@src/providers/ThemeProvider.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dnd-kit dependencies</name>
  <files>package.json</files>
  <action>
    Install @dnd-kit/core and @dnd-kit/modifiers:
    ```bash
    npm install @dnd-kit/core @dnd-kit/modifiers
    ```

    Do NOT install @dnd-kit/sortable - we're doing cross-container drops, not sortable lists.
  </action>
  <verify>npm ls @dnd-kit/core shows installed version</verify>
  <done>@dnd-kit/core and @dnd-kit/modifiers in dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create drag-drop TypeScript types</name>
  <files>src/types/dnd.ts</files>
  <action>
    Create type definitions for drag-drop data:

    1. **GoalDragData** - data attached to draggable goals:
       - type: 'goal' (literal)
       - goalId: string
       - roleId: string
       - text: string

    2. **BlockDragData** - data attached to draggable time blocks (for Phase 5 Plan 04):
       - type: 'block' (literal)
       - blockId: string
       - sourceDay: DayOfWeek

    3. **DropZoneData** - data attached to droppable zones:
       - zone: 'priorities' | 'timegrid' | 'evening'
       - dayIndex: DayOfWeek
       - slotIndex?: TimeSlotIndex (only for timegrid)

    4. **DragData** - union type: GoalDragData | BlockDragData

    Import DayOfWeek and TimeSlotIndex from @/types.
    Export all types.
  </action>
  <verify>tsc --noEmit passes</verify>
  <done>Types exported and importable from @/types/dnd</done>
</task>

<task type="auto">
  <name>Task 3: Create DndProvider component</name>
  <files>src/components/dnd/DndProvider.tsx, src/components/dnd/DragOverlayContent.tsx, src/components/dnd/index.ts</files>
  <action>
    Create the dnd infrastructure components:

    **DndProvider.tsx** ("use client" component):
    1. Import DndContext, DragEndEvent, DragStartEvent, DragOverlay, PointerSensor, KeyboardSensor, useSensor, useSensors, closestCenter from @dnd-kit/core
    2. Create state for activeData: DragData | null
    3. Configure sensors:
       - PointerSensor with activationConstraint: { distance: 8 } (prevent accidental drags)
       - KeyboardSensor for accessibility
    4. Implement handlers:
       - onDragStart: Set activeData from event.active.data.current
       - onDragEnd: Call handleDrop (stub for now - will be implemented in later plans), then clear activeData
       - onDragCancel: Clear activeData
    5. Render DndContext wrapping children with DragOverlay containing DragOverlayContent

    **CRITICAL:** Always keep DragOverlay mounted, only conditionally render its children:
    ```tsx
    <DragOverlay dropAnimation={{ duration: 200, easing: 'ease' }}>
      {activeData ? <DragOverlayContent data={activeData} /> : null}
    </DragOverlay>
    ```

    **DragOverlayContent.tsx** ("use client" component):
    1. Accept data: DragData prop
    2. For type 'goal': Render a preview div with goal text, styled similar to GoalItem (border-left color accent)
    3. For type 'block': Render a preview div with block title
    4. Use pointer-events-none and shadow-lg for overlay styling
    5. Import getRoleColorStyle from @/lib/role-colors for goal color

    **index.ts**: Export DndProvider as default and named.
  </action>
  <verify>npm run build passes without errors</verify>
  <done>DndProvider component ready with DragOverlay infrastructure</done>
</task>

<task type="auto">
  <name>Task 4: Wire DndProvider into application</name>
  <files>src/app/layout.tsx</files>
  <action>
    Wrap the app content with DndProvider:

    1. Import DndProvider from @/components/dnd
    2. Add DndProvider inside ThemeProvider, wrapping {children}

    Provider order (outer to inner):
    - ThemeProvider
      - DndProvider
        - {children}

    DndProvider must be inside ThemeProvider so it can access theme context if needed.
  </action>
  <verify>npm run dev loads without errors, check console for any dnd-kit warnings</verify>
  <done>DndProvider wraps application, ready for draggable/droppable components</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] npm ls @dnd-kit/core shows version 6.x
- [ ] npm run build succeeds
- [ ] App loads without errors
- [ ] No console errors related to dnd-kit
- [ ] TypeScript types compile cleanly
</verification>

<success_criteria>

- @dnd-kit/core and @dnd-kit/modifiers installed
- TypeScript types for drag data defined
- DndProvider component created with sensors and DragOverlay
- Application wrapped with DndProvider
- Ready for draggable/droppable components in subsequent plans
</success_criteria>

<output>
After completion, create `.planning/phases/05-drag-drop-integration/05-01-SUMMARY.md`
</output>
